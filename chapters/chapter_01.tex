%%%%%%%%%%%%%%%%%%%ASSUMPTION 1%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{asu}
  \label{assumption_1}
  Assume, the following conditions hold:
\\
  \subasu 
    \label{assumption_1_i} 
    The minimizer 
    $
    \lambda_0 
    =
    \arg \min_{\lambda \in \Theta}
    \E
    \left[ 
      -T n 
      \rho 
      \left( 
      B(X)^T \lambda
      \right)
      +
      B(X)^T \lambda
    \right]
    $
    is unique,
    where 
    $\Theta \subseteq \R^n$ is the parameter space for $\lambda$.
\\ %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \subasu 
    \label{assumption_1_ii} 
    The parameter space 
    $\Theta \subseteq \R^n$
    is compact compact with diameter
    $\text{diam}(\Theta) < \infty$.
\\ %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \subasu 
    \label{assumption_1_iii}
    $\lambda_0 \in \text{int}(\Theta)$,
    where
    $\text{int}(\cdot)$
    stands for the interior of a set.
\\ %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \subasu
    \label{assumption_1_iv}
    There exists
    $\lambda^*_1 \in \Theta$
    such that
    $
      \norm{
        m^*(\cdot)
        -
        B(\cdot)^T \lambda^*_1
      }_\infty
      \le 
      \varphi_{m^*}
    $,
    where
    $
      m^*(\cdot)
      :=
      \left( \rho^{'} \right)^{-1}
      \left( \frac{1}{n \pi(\cdot)} \right).
    $
\\ %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \subasu
    \label{assumption_1_v}
    There exists a constant 
    $
      \varphi_{\rho^{'} \lor \pi} 
      \in 
      \left(0, \frac{1}{2} \right)
    $
    such that
    $
      n\rho(v) 
      \in 
      (
      \varphi_{\rho^{'} \lor \pi},
      1 - \varphi_{\rho^{'} \lor \pi}
      )
    $
    for $v=B(x)^T \lambda$ with $\lambda \in \text{int}(\Theta)$ 
    \textbf{or}
    $
      \pi(x)
      \in 
      (
      \varphi_{\rho^{'} \lor \pi},
      1 - \varphi_{\rho^{'} \lor \pi}
      )
    $.
\\ %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \subasu
    \label{assumption_1_vi}
    There exists 
    $ \varphi_{\rho^{''}} > 0 $
    such that
    $ -\rho^{''} \ge \varphi_{\rho^{''}} > 0 $
\\ %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \subasu
    \label{assumption_1_vii}
    There exists 
    $ \varphi_{B(x) B(x)^T} > 0 $ 
    such that
    $
      B(x) B(x)^T 
      \succcurlyeq 
      \varphi_{B(x) B(x)^T} I 
    $
\\ %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \subasu
    \label{assumption_1_viii}
    There exists
    $ \varphi_{\norm{B}} > 0 $
    such that
    $
      \sup_{x \in \mathcal{X}} \norm{B(x)}_2
      \le 
      \varphi_{\norm{B}}
    $.
\end{asu}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

We study the following problem:

\begin{align}
  \label{primal_weighting_binary}
  \begin{split}
  &\underset{w \in \R^n}{\text{minimize}}
  \qquad
  \sum_{i = 1}^{n} T_i f(w_i)
  \\
  &\text{subject to}
  \left| 
    \sum_{i = 1}^{n} w_i T_i B_k(X_i)
    - 
    \frac{1}{n} \sum_{i = 1}^{n} B_k(X_i)
  \right|
  \le 
  \delta_k,\,
  k = 1, \ldots, K
  \end{split}
\end{align}


\begin{proposition}
  \label{ch_1_dual}
  The dual of Problem \eqref{primal_weighting_binary} is equivalent to the unconstrained optimization problem
  \begin{gather}
    \label{dual_weighting_binary}
      \underset{\lambda \in \R^K}{\text{minimize}}
      \quad
      \frac{1}{n}
      \sum_{j = 1}^{n} 
      \left[ 
        -T_j n 
        \rho 
        \left( 
          B(X_j)^T \lambda
        \right)
      +
      B(X_j)^T \lambda
      \right]
      +
      |\lambda|^T \delta
  \end{gather}
\end{proposition}


\begin{proposition}
  \label{ch_1_near_oracle}
  There exists a solution $\lambda^\dagger$ 
  to \eqref{dual_weighting_binary}
  such that
  \begin{gather}
    \P
    \left( 
      \norm{
        \lambda^\dagger
        -
        \lambda^*_1
      }_2
      \le
      \CP \Ctau \LearnRate
    \right)
    \ge 
    1 - \tau
    .
  \end{gather}
\end{proposition}


\section{Plan of proof}
We employ 
Theorem~\ref{cvxa_fenchel_theorem}
together with the box constraints in Problem~\eqref{primal_weighting_binary}
to obtain Proposition~\ref{ch_1_dual}.

To prove Proposition~\ref{ch_1_near_oracle}
we employ
Proposition~\ref{syu_1_result}
and 
Corollary~\ref{syu_taylor_corollary}
to get

\begin{align}
  \begin{split}
  & 
  G(\lambda^*_1 + \Delta) 
  -
  G(\lambda^*_1)
  \\
  &\ge
      \frac{1}{n}
      \sum_{j = 1}^{n} 
      \left[ 
        -T_j n 
        \rho^{'} 
        \left( 
          B(X_j)^T \lambda^*_1
        \right)
      +
      1
      \right]
      \Delta^T B(X_j)
      \\
  & +
      \frac{1}{2}
      \sum_{j = 1}^{n} 
        -T_j  
        \rho^{''} 
        \left( 
          B(X_j)^T (\lambda^*_1 + \xi \Delta)
        \right)
        \Delta^T
        \left( 
          B(X_j)
          B(X_j)^T
        \right)
        \Delta
        \\
  &-
      |\Delta|^T \delta
  \\
  &\ge
    - \norm{\Delta}_2
    \left( 
    \norm{
      \frac{1}{n}
      \sum_{j = 1}^{n} 
      \left[ 
        -T_j n 
        \rho^{'} 
        \left( 
          B(X_j)^T \lambda^*_1
        \right)
      +
      1
      \right]
      B(X_j)
    }_2
    +
    \norm{\delta}_2
    \right)
    \\
  &+
  n
  \norm{\Delta}^2_2
   \varphi_{\rho^{''}}
  \underline{\varphi_{aa^T}}
  \end{split}
\end{align}

Next we employ Bernstein inequality~\ref{rmineq_bernstein} to bound
\begin{align}
    \norm{
      \frac{1}{n}
      \sum_{j = 1}^{n} 
      \left[ 
        -T_j n 
        \rho^{'} 
        \left( 
          B(X_j)^T \lambda^*_1
        \right)
      +
      1
      \right]
      B(X_j)
    }_2
    \le
    \CP \Ctau \LearnRate
\end{align}
with probability $1 - \tau$.
Then for 
$\norm{\Delta}_2$ large enough it holds
\begin{gather}
  G(\lambda^*_1 + \Delta) 
  -
  G(\lambda^*_1)
  >
  0
\end{gather}
with probability $1 - \tau$.
Thus by Proposition~\ref{syu_1_result}
  \begin{gather}
    \P
    \left( 
      \norm{
        \lambda^\dagger
        -
        \lambda^*_1
      }_2
      \le
      \norm{\Delta}_2
    \right)
    \ge 
    1 - \tau
    .
  \end{gather}
It is then straightforward to prove

\begin{theorem}
  Let 
  $\lambda^\dagger$
  be the solution to Problem~\ref{dual_weighting_binary}
  and 
  $w^*(x)=\rho^{'}\left( B(x)^T \lambda^\dagger \right)$.
  Then under the conditions in Assumption~\ref{assumption_1}
  it holds

  \begin{align}
  \norm{
    w^*(\cdot)
    -
    \frac{1}{n \pi(\cdot)}
  }_{\P, 2}
  \le 
  \text{stuff}
  \end{align}
and 
  \begin{align}
    \P
    \left( 
  \norm{
    w^*(\cdot)
    -
    \frac{1}{n \pi(\cdot)}
  }_\infty
  \le 
  \text{stuff}
   \right)
   \ge
  1 - \tau
  .
  \end{align}
\end{theorem}


\begin{proof}
  Motivated by Proposition~\ref{syu_1_result}
  we set
  $\norm{\Delta}_2 = C$ 
  and consider
 \begin{gather}
   G(\lambda)
   :=
      \frac{1}{n}
      \sum_{j = 1}^{n} 
      \left[ 
        -T_j n 
        \rho 
        \left( 
          B(X_j)^T \lambda
        \right)
      +
      B(X_j)^T \lambda
      \right]
      +
      |\lambda|^T \delta.
 \end{gather} 
 Since 
 $\rho \in C^2(\R)$
 we can employ 
 Proposition~\ref{syu_1_result},
 Corollary~\ref{syu_taylor_corollary}
 and
 Proposition~\ref{syu_triangle}
 to get
 \begin{align}
  \begin{split}
  & 
  G(\lambda^*_1 + \Delta) 
  -
  G(\lambda^*_1)
  \\
  &\ge
      \frac{1}{n}
      \sum_{j = 1}^{n} 
      \left[ 
        -T_j n 
        \rho^{'} 
        \left( 
          B(X_j)^T \lambda^*_1
        \right)
      +
      1
      \right]
      \Delta^T B(X_j)
      \\
  & +
      \frac{1}{2}
      \sum_{j = 1}^{n} 
        -T_j  
        \rho^{''} 
        \left( 
          B(X_j)^T (\lambda^*_1 + \xi \Delta)
        \right)
        \Delta^T
        \left( 
          B(X_j)
          B(X_j)^T
        \right)
        \Delta
        \\
  &-
      |\Delta|^T \delta
  \\
  &\ge
    - \norm{\Delta}_2
    \left( 
    \norm{
      \frac{1}{n}
      \sum_{j = 1}^{n} 
      \left[ 
        -T_j n 
        \rho^{'} 
        \left( 
          B(X_j)^T \lambda^*_1
        \right)
      +
      1
      \right]
      B(X_j)
    }_2
    +
    \norm{\delta}_2
    \right)
    \\
  &+
  n
  \norm{\Delta}^2_2
   \varphi_{\rho^{''}}
  \underline{\varphi_{aa^T}}
  \\
  &:=
  -\norm{\Delta}_2
  (I_1 + \norm{\delta}_2)
  +
  \norm{\Delta}^2_2
  I_2
  .
  \end{split}
\end{align}
The second inequality is due to 
the Cauchy-Schwarz-Inequality 
and
Assumptions~\ref{assumption_1_vi} and \ref{assumption_1_vii}
.
\subsection*{Analysis of $I_1$}
We want to use Assumption~\ref{assumption_1_iii}.
Thus we perform the following split:
\begin{align}
  I_1 
  &\le
    \norm{
      \sum_{j = 1}^{n} 
        T_j  
      \left[ 
        \rho^{'} 
        \left( 
          B(X_j)^T \lambda^*_1
        \right)
      -
      \frac{1}{n \pi(X_j)}
      \right]
      B(X_j)
    }_2
  \\
  &+
    \norm{
      \frac{1}{n}
      \sum_{j = 1}^{n} 
      \left[ 
        \frac{T_j}{\pi(X_j)}
      -
      1
      \right]
      B(X_j)
    }_2
    \\
  &=:
  J_1 + J_2
\end{align}

\subsubsection*{Analysis of $J_1$}

By the Lipschitz-continuity of 
$\rho^{'}$,
Assumption~\ref{assumption_1_viii}
and
Assumption~\ref{assumption_1_iv},
$T \in \{0, 1\}$
and 
the triangle inequality 
we have
\begin{gather}
  J_1 
  \le
  n L_{\rho^{'}}\varphi_{\norm{B(x)}} \varphi_{m^*}
\end{gather}

\subsubsection*{Analysis of $J_2$}
We employ Bernstein Inequality for matrices
To this end we define
\begin{gather}
  A_j
  :=
      \frac{1}{n}
      \left[ 
        \frac{T_j}{\pi(X_j)}
      -
      1
      \right]
      B(X_j)
\end{gather}

\subsubsection*{$\E A_j = 0$}

It holds

\begin{gather}
  \E
  \left[  
    \frac{T_j}{\pi(X_j)}
    B(X_j)
  \right]
  =
  \E
  \left[  
    \E
    \left[  
      T_j
      \, | \,
      X_j
    \right]
    \frac{1}{\pi(X_j)}
    B(X_j)
  \right]
  =
  \E[B(X_j)]. 
\end{gather}
Thus 
$\E[A_j] = 0$.
\subsubsection*{L}
Since
\begin{gather}
  \left| 
      \frac{T_j}{\pi(X_j)}
      -
      1
      \right|
  \le
  1 + \frac{1 - \varphi_{\pi}}{\varphi_{\pi}}
  =
  \frac{1}{\varphi_{\pi}}
\end{gather}
by Assumption~\ref{assumption_1_v},
we can employ Assumption~\ref{assumption_1_viii}
to get
\begin{gather}
  \norm{A_j}_2
  \le
  \frac{\varphi_{\norm{B}}}{n \varphi_{\pi}}
  =:
  L.
\end{gather}
\subsubsection*{v(S)}
Since
\begin{gather}
  \E
  \left[ 
    A_j A_j^T
  \right]
  \le
  \left( 
    \frac{1}{n \varphi_{\pi}}
  \right)^2
  \E
  \left[ 
    B(X) B(X)^T
  \right]
\end{gather}
and
\begin{gather}
  \E
  \left[ 
    A_j^T A_j
  \right]
  \le
  \left( 
    \frac{\varphi_{\norm{B}}}{n \varphi_{\pi}}
  \right)^2
\end{gather}
we have
\begin{gather}
  v(S)
  \le
  \frac{|\lambda_{\max} | + \varphi_{\norm{B}}^2}{n \varphi_{\pi}^2},
\end{gather}
where 
$\lambda_{\max}$ is the maximal eigenvalue of
$
  \E
  \left[ 
    B(X) B(X)^T
  \right]
$.
Then by Bernsteins inequality~\ref{rmineq_bernstein}
we get
\begin{gather}
  \E[J_2]
  \le
  \sqrt{
    \frac{
    2 \log (K + 1)
    \left( 
      |\lambda_{\max} | + \varphi_{\norm{B}}^2
    \right)
    }
    {
      n \varphi_{\pi}^2
    }
  }
  +
  \frac{
    \log (K + 1)
    \varphi_{\norm{B}}
  }
  {
    3 n \varphi_{\pi}
  }
\end{gather}
and by the Markov-inequality
\begin{gather}
  \P
  \left( 
    J_2 
    \le
    \frac{1}{\tau}
    \E[J_2]
  \right)
  \ge 
  1 - \tau
\end{gather}
\end{proof}
