Based on Theorem~\ref{dual_solution_th}
we want to use the dual 
solution 
$
\left( \rho^\dagger,\lambda_0^\dagger,\lambda^\dagger \right)
$
to construct weights.
To this end, we define the (empirical) weights function
\begin{align*}
 w\ \colon\
 &
 \left( 
  \R^d\times \R^{d\cdot N}
 \right)
  \times
  \left( 
\R^N_{\ge 0}\times \R\times \R^N
  \right)
  \to
  \R^N
  \\
 &
  \left( 
  (x,x_1,\ldots,x_N),(\rho,\lambda_0,\lambda)
  \right)
  \ 
  \mapsto
  \ 
  \left[ 
  (\varphi^{'})^{-1}
  \left( 
    \rho_i
    +
    \lambda_0
    +
    \inner
    {B(x,x_1,\ldots,x_N)}
    {\lambda}
  \right)
\right]_{i\in \left\{ 1,\ldots,N \right\}}
\,.
\end{align*}
\begin{definition}
  Let 
  $
\left( \rho^\dagger,\lambda_0^\dagger,\lambda^\dagger \right)
  $
  be the dual solution of Lemma~\ref{lem:meas_dual_sol}.
  We define the weights process 
  $\left\{ w^\dagger(x) | x\in\R^d\right\}$
  by
  \begin{align*}
    w^\dagger(x) 
    \ 
    :=
    \ 
    w
    \left( 
    \left( 
    x,X_1,\ldots,X_N,
    \right)
    ,
\left( \rho^\dagger,\lambda_0^\dagger,\lambda^\dagger \right)
    \right)
    \qquad
    \text{for all}\ 
    x\in\R^d
    \,.
  \end{align*}
\end{definition}
\begin{lemma}
  \label{lem:weights:meas}
  \quad
  \begin{enumerate}[label=(\roman*)]
\item
  $w^\dagger(\cdot)(\omega)$ is 
  $\left(
    \mathcal{B}(\R^d),\mathcal{B}(\R^N)
  \right)$-measurable
  and
  constant on each cell 
  $A_N\in\mathcal{P}_N$
  for all $\omega\in\Omega$. 
\item
  $w^\dagger(X)$ is $\left(
    \sigma(X,D_N),\mathcal{B}(\R^N)
  \right)$-measurable. 
  \end{enumerate}
\end{lemma}
\begin{proof}
  This is a direct consequence of Lemme~\ref{lem:basis_meas}, Lemma~\ref{lem:meas_dual_sol}
  and 
  the (assumed) continuity of $(\varphi^{'})^{-1}$.
\end{proof}


\begin{lemma}
  \label{weights_l_inf}
  It holds
  $w_i^\dagger(X)\in L^\infty(\P)$
  for all $i\in \left\{ 1,\ldots,N \right\}$.
\end{lemma}
\begin{proof}
  By Lemma~\ref{lem:basis_sum}.\textit{(iii)} it holds
  \begin{align*}
  \left| 
    \rho_i^\dagger
    +
    \lambda_0^\dagger
    +
    \inner
    {B(x,x_1,\ldots,x_N)}
    {\lambda^\dagger}
  \right|
  \ 
  \lesssim
  \ 
  \norm{
\left( \rho^\dagger,\lambda_0^\dagger,\lambda^\dagger \right)
  }_2
  \qquad
  \text{for all}\ 
  i \in \left\{ 1,\ldots,N \right\}
  \,.
  \end{align*}
  Since
  $
\left( \rho^\dagger,\lambda_0^\dagger,\lambda^\dagger \right)
  $ is contained in the deterministic and compact parameter space $\Theta_N$,
  it holds
  \begin{align*}
  \norm{
\left( \rho^\dagger,\lambda_0^\dagger,\lambda^\dagger \right)
  }_2
  \in 
  L^{\infty}(\P)
  \,.
  \end{align*}
  By the (assumed) uniform continuity of 
  $
  (\varphi^{'})^{-1}
  $
  on $\R$, it follows 
  $w_i^\dagger(X)\in L^\infty(\P)$
  for all $i\in \left\{ 1,\ldots,N \right\}$.
\end{proof}
Next, we want to simplify the weights process in the spirit of Lemma~\ref{lem:simple_weights}.
In other words, we want to become independent of the index $i$ in $w_i^\dagger$. This will be helpful in the subsequent analysis.
To this end, we define the (empirical) simplified weights function
\begin{align*}
 w_0\ \colon\
 &
 \left( 
  \R^d\times \R^{d\cdot N}
 \right)
  \times
  \left( 
    \R\times \R^N
  \right)
  \to
  [0,\infty)
  \\
 &
  \left( 
  (x,x_1,\ldots,x_N),(\lambda_0,\lambda)
  \right)
  \ 
  \mapsto
  \ 
  \left[ 
  (\varphi^{'})^{-1}
  \left( 
    \lambda_0
    +
    \inner
    {B(x,x_1,\ldots,x_N)}
    {\lambda}
  \right)
\right]^+
\,.
\end{align*}
\begin{definition}
  Let 
  $
\left( \rho^\dagger,\lambda_0^\dagger,\lambda^\dagger \right)
  $
  be the dual solution of Lemma~\ref{lem:meas_dual_sol}.
  We define the simplified weights process 
  $\left\{ w_0^\dagger(x) \,|\, x\in\R^d\right\}$
  by
  \begin{align*}
    w_0^\dagger(x) 
    \ 
    :=
    \ 
    w_0
    \left( 
    \left( 
    x,X_1,\ldots,X_N,
    \right)
    ,
\left( \lambda_0^\dagger,\lambda^\dagger \right)
    \right)
    \qquad
    \text{for all}\ 
    x\in\R^d
    \,.
  \end{align*}
\end{definition}
\begin{lemma}
  \label{lem:weights:meas:0}
  \quad
  \begin{enumerate}[label=(\roman*)]
\item
  $w_0^\dagger(\cdot)(\omega)$ is 
  $\left(
    \mathcal{B}(\R^d),\mathcal{B}(\R^N)
  \right)$-measurable
  and
  constant on each cell 
  $A_N\in\mathcal{P}_N$
  for all $\omega\in\Omega$. 
\item
  $w_0^\dagger(X)$ is $\left(
    \sigma(X,D_N),\mathcal{B}(\R^N)
  \right)$-measurable. 
  \end{enumerate}
\end{lemma}
\begin{proof}
The proof is as that of Lemma~\ref{lem:weights:meas}.
\end{proof}


\begin{lemma}
  \label{weights_0_l_inf}
  It holds $w_0^\dagger(X)\in L^\infty(\P)$.
\end{lemma}
\begin{proof}
  By Lemma~\ref{weights_l_inf},
  the monotonicity of 
  $
  (\varphi^{'})^{-1}
  $
  and $\rho_i\ge 0$ for $i\le n$,
  it holds
  \begin{align*}
    w_0^\dagger(X) 
    &
    \ 
    \le
    \ 
  \left[ 
  (\varphi^{'})^{-1}
  \left( 
    \lambda_0^\dagger
    +
    \inner
    {B(X)}
    {\lambda^\dagger}
  \right)
\right]^+
\\
&
\ 
\le
\ 
  \left[ 
  (\varphi^{'})^{-1}
  \left( 
    \rho_i^\dagger
    +
    \lambda_0^\dagger
    +
    \inner
    {B(X)}
    {\lambda^\dagger}
  \right)
\right]^+
\ 
\le
\ 
\left| 
    w_i^\dagger(X) 
\right|
\ 
\in
\ 
L^\infty(\P)
  \end{align*}
\end{proof}
\begin{lemma}
  \label{w.Z=0}
 Let 
 $Z\in L^1(\P)$
  be a random variable that is independent of $D_N=(T_i,X_i)_{i\in \left\{
    1,\ldots,N
  \right\}}$ 
  with
  $
\E
\left[
  Z
  \,
  |
  \, 
  X
\right]
= 0
  $
  almost surely.
  It holds
  \begin{gather*}
  \E
  \left[
    w_0^\dagger(X)
  \cdot Z
  \right]
  \ 
  =
  \ 
  0
  \,.
  \end{gather*}
\end{lemma}
\begin{proof}
  By Lemma~\ref{weights_0_l_inf} it holds
  \begin{gather}
    \label{9876}
    \norm{
  w_0^\dagger(X)\cdot Z
    }_{L^1(\P)}
    \ 
  \le
    \ 
  \norm{w_0^\dagger(X)}_{L^\infty(\P)}
  \norm{Z}_{L^1(\P)}
  \ 
  <
  \ 
  \infty
  \,.
  \end{gather}
  By 
  \eqref{9876},
  $Z\perp D_N$
  and
  $
\E
\left[
  Z
  \,
  |
  \, 
  X
\right]
= 0
  $
  almost surely
  it holds 
  \begin{align*}
    \E
  \left[
  w_0^\dagger(X)
  \cdot
  Z
  \,
  |
  \,
  D_N,X
  \right]
  &
  \ 
  =
  \ 
  w_0^\dagger(X)
  \cdot
  \E
  \left[
  Z
  \,
  |
  \,
  D_N,X
  \right]
  \\
  &
  \ 
  =
  \ 
  w_0^\dagger(X)
  \cdot
  \E
  \left[
  Z
  \,
  |
  \,
  X
  \right]
  \
  =
  \ 
  0
  \qquad
  \text{almost surely.}
  \end{align*}
  Note, that $w_0^\dagger(X)$ is 
  $
  \left(
  \sigma(D_N,X),\mathcal{B}(\R)
  \right)
  $-measurable.  
  Thus
  \begin{gather*}
    \E
    \left[
  w_0^\dagger(X)
  \cdot
  Z
  \,
    \right]
    \ 
    =
    \ 
    \E
    \left[
 \E
  \left[
  w_0^\dagger(X)
  \cdot
  Z
  \,
  |
  \,
  D_N,X
  \right]
    \right]
    \ 
    =
    \ 
    0
    \,.
     \end{gather*}
\end{proof}

\begin{theorem}
  \label{th:weights_constr}
  The simplified weights process satisfies the constraints
  of Problem~\ref{bw:1:primal}, that is,
  \begin{enumerate}[label=(\roman*)]
    \item
      $
      T_i\cdot w_0^\dagger(X_i)
      \ 
      \ge
      \ 
      0
      \qquad
      \text{for all}\ 
      i\in  \left\{ 1,\ldots,N \right\}
      $
    \item
      $
      \frac{1}{N}
      \sum_{i=1}^{N} 
      T_i\cdot w_0^\dagger(X_i)
      \ 
      =
      \ 
      1
      $
    \item
      For all $k\in \left\{ 1,\ldots,N \right\}$
      it holds
      \begin{align*}
      \left| 
      \frac{1}{N}
      \left( 
        \sum_{i=1}^{N} 
      T_i\cdot w_0^\dagger(X_i)
      \cdot
        B_k(X_i,X_1,\ldots,X_N)
        \
        -
        \
        \sum_{i=1}^{N} 
        B_k(X_i,X_1,\ldots,X_N)
      \right)
      \right|
      \ 
      \le
      \ 
      \delta_k
      \end{align*}
  \end{enumerate}
\end{theorem}
\begin{proof}
  This follows from Theorem~\ref{dual_solution_th},
  Lemma~\ref{lem:simple_weights}
  and the construction of the simplified weights process.
\end{proof}
To avoid notational overload, from now on we write
\begin{align*}
  B(x)
  \ 
  :=
  \ 
  B(x,X_1,\ldots,X_N)
  \qquad
  \text{for all}\ 
  x\in\R^d
  \,.
\end{align*}
