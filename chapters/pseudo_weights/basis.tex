Let $
\left(
\mathcal{P}_N
\right)
$
denote a sequence of countable, $\mathcal{B}$-measurable partitions 
\begin{align*}
\mathcal{P}_N= \left\{
  A_{N,1},
  A_{N,2},
  \ldots
\right\}
\subset \mathcal{B}(\R^d)
\end{align*}
of $\R^d$, that is, 
\begin{align*}
  A_{N,i}\cap A_{N,j}=\emptyset
  \qquad
  \text{if}\ i\neq j
  \qquad
  \text{and}
  \qquad 
  \bigcap_{i\in\mathbb{N}}A_{N,i}
  \ 
  =
  \ 
  \R^d
  \,.
\end{align*}
We define
$ A_N(x) $ to be the cell of $ \mathcal{P}_N $ containing $x$, that is,
\begin{align*}
  A_N
  \colon
  \R^d 
  \ 
  \twoheadrightarrow 
  \ 
  \R^d  
  \,,\qquad
  x
  \ 
  \mapsto
  \ 
  A_N(x)
  \,,
\end{align*}
where $A_N(x)$ is the only cell containing $x$. 

Next, we define the (empirical) basis functions vector
\begin{align}
  \label{def:basis}
  B\colon
  \R^d\times \R^{d\cdot N}
  \ 
  \to
  \ 
  \R
  \,,
  \qquad
  (x,(x_1,\ldots,x_N))
  \ 
  \mapsto
  \ 
  \frac
  {
    \left[
    \mathbf{1}
    _{
      A_N(x)
    }
    (x_k)
    \right]
    _{k\in \left\{
        1,\ldots,N
    \right\}}
  }
  {
    \sum_{j=1}^N
    \mathbf{1}
    _{
      A_N(x)
    }
    (x_j)
    }
  \,,
\end{align}
where we keep to the convention $"0/0=0"$.
We shall extend $B$ to depend on the random vectors
$X,X_1,\ldots,X_N$.
The next lemma studies the measurability of the extensions.
\begin{lemma}
  \label{lem:basis_meas}
  \quad
  \begin{enumerate}[label=(\roman*)]
\item
  $B(\cdot,(X_1,\ldots,X_N))(\omega)$ is 
  $\left(
    \mathcal{B}(\R^d),\mathcal{B}(\R^N)
  \right)$-measurable
  and
  constant on each cell 
  $A_N\in\mathcal{P}_N$
  for all $\omega\in\Omega$. 
\item
  $B(X,(X_1,\ldots,X_N))$ is $\left(
    \mathcal{A},\mathcal{B}(\R^N)
  \right)$-measurable. 
  \end{enumerate}
\end{lemma}

\begin{proof}
Consider
for $k\in \left\{
  1,\ldots,N
\right\}$
and $\omega\in\Omega$
the indicator function
\begin{align}
  \label{33342}
  \mathbf{1}
  _
  {A_N(X_k(\omega))}
  \colon \R^d\to \left\{
    0,1
  \right\}
  \,.
\end{align}
Since 
$
  {A_N(X_k(\omega))}
  \in\mathcal{B}(\R^d)
$
this is a 
  $\left(
    \mathcal{B}(\R^d),\mathcal{B}(\R)
  \right)$-measurable
  function.
  From the definition of $B$ \eqref{def:basis} it follows the first part of (i).
  Since the indicator function in \eqref{33342} is 1 if $
  x\in
  {A_N(X_k(\omega))}
  $
  and 0 else, it is also constant on each cell
  $A_N\in\mathcal{P}_N$.
  It follows (i).
  To prove (ii), note that
\begin{align*}
  \mathbf{1}
  _
  {A_N(X_k(\omega))}(X(\omega))
  \ 
  =
  \ 
  \mathbf{1}
  \bigcup_{i\in\mathbb{N}}
  \left\{
    X,X_k \in A_{N,i}
  \right\}
  (\omega)
  \qquad
  \text{for all}\ 
  \omega\in\Omega
  \,,
\end{align*}
and
$
  \bigcup_{i\in\mathbb{N}}
  \left\{
    X,X_k \in A_{N,i}
  \right\}
  \in\mathcal{A}
$ by the 
$
\left( 
  \mathcal{A},
  \mathcal{B}(\R^d)
\right)
$-
measurability of $X$ and $X_k$.
\end{proof}

\begin{lemma}
  Let $(x,x_1,\ldots,x_N)\in\R^{d(N+1)}$.
  \begin{enumerate}[label=(\roman*)]
    \item
      $
      \sum_{k=1}^{N} 
      B_k(x,x_1,\ldots,x_N)
      \in
      \left\{ 0,1 \right\}
      $. 
      In particular,
      $
        x_1,\ldots,x_N\notin A_N(x)
      $
      is equivalent to
      $
      \sum_{k=1}^{N} 
      B_k(x,x_1,\ldots,x_N)
      =0
      $
  \end{enumerate}
\end{lemma}
\begin{proof}
  Let $(x,x_1,\ldots,x_N)\in\R^{d(N+1)}$.
  We prove \textit{(i)}.
  If 
      $
        x_1,\ldots,x_N\notin A_N(x)
      $,
  then
  \begin{align*}
    B_k(
        x,x_1,\ldots,x_N
    )
    \ 
    =
    \ 
\frac
  {
    \mathbf{1}
    _{
      A_N(x)
    }
    (x_k)
  }
  {
    \sum_{j=1}^N
    \mathbf{1}
    _{
      A_N(x)
    }
    (x_j)
    }
    \ 
    =
    \ 
    0
    \qquad
    \text{for all}\ 
    k\in \left\{ 1,\ldots,N \right\}
    \,.
  \end{align*}
  On the other hand, if the sum is 0 it holds
  \begin{align*}
    \mathbf{1}
    _{
      A_N(x)
    }
    (x_k)
    \ 
  =
  \ 
  0
    \qquad
    \text{for all}\ 
    k\in \left\{ 1,\ldots,N \right\}
    \,.
  \end{align*}
  It follows the desired equivalence.
  If 
  \begin{align*}
    \mathbf{1}
    _{
      A_N(x)
    }
    (x_k)
    \ 
  =
  \ 
  1
    \qquad
    \text{for some}\ 
    k\in \left\{ 1,\ldots,N \right\}
    \,,
  \end{align*}
  then
  $
    \sum_{j=1}^N
    \mathbf{1}
    _{
      A_N(x)
    }
    (x_j)
    \ge 1
  $
  and thus "$0/0$" doesn't occure. 
  It follows
  \begin{align*}
      \sum_{k=1}^{N} 
      B_k(x,x_1,\ldots,x_N)
      \ 
      =
      \ 
\frac
  {
      \sum_{k=1}^{N} 
    \mathbf{1}
    _{
      A_N(x)
    }
    (x_k)
  }
  {
    \sum_{j=1}^N
    \mathbf{1}
    _{
      A_N(x)
    }
    (x_j)
    }
    \ 
    =
    \ 
    1
    \,.
  \end{align*}
\end{proof}
\begin{lemma}
  For all continuous functions $f\colon \R^d\to \R$ it holds
 \begin{align}
   \begin{split}
   &
   \left|
  \sum_{k=1}^{N}
    B_k(X,X_1,\ldots,X_N)\cdot 
    f(X_k)
    -
    f(X)
   \right|
   \ 
   \le
   \ 
   \omega
   \left(
    f,h_N^d
   \right)
   \,,
   \end{split}
 \end{align}
 where $\omega(f,\cdot)$ is the modulus of continuity of $f$. 

\end{lemma}

\begin{proof}
  \begin{align}
   \begin{split}
   &
   \left|
  \sum_{k=1}^{N}
    B_k(X_i,X_1,\ldots,X_N)\cdot 
    f(X_k)
    -
    f(X_i)
   \right|
   \\
   &
   \ 
   \le
   \ 
  \sum_{k=1}^{N}
    B_k(X_i,X_1,\ldots,X_N)
    \mathbf{1}\left\{
      X_k\in A_N(X_i)
    \right\}
    \left|
    f(X_k)
    -
    f(X_i)
    \right|
   \\
   &
   \ 
   \le
   \ 
   \omega
   \left(
    f,h_N^d
   \right)
   \,,
   \end{split}
 \end{align}

\end{proof}

\begin{lemma}
  \begin{enumerate}[label=(\roman*)]
    \item
      $\norm{B(X,X_1,\ldots,X_N)}_2\lesssim 1$ 
      \item
      $
      \sum_{i=1}^{N}
        B_k(X,X_1,\ldots,X_N)
        =1
      $
      for all $i\in \left\{
        1,\ldots,N
      \right\}$
      \item
      \begin{align*}
        \frac
        {1}
        {N}
        \sum_{i,k=1}^{N}
            \left|
        B_k(X_i,X_1,\ldots,X_N)
        \cdot
            \varphi
            \left(
              \frac
              {1}
              {\pi(X_k)}
            \right)
            \ 
            -
            \ 
            \varphi
            \left(
              \frac
              {1}
              {\pi(X_i)}
            \right)
            \right|
            \ 
            \to
            \ 
            0
            \qquad
            \text{for}
            \ 
            N\to\infty
          \end{align*}
\item
      \begin{align*}
        \frac
        {1}
        {\sqrt{N}}
        \sum_{i,k=1}^{N}
        \sup_{z\in\R}
            \left|
        B_k(X,X_1,\ldots,X_N)
        \cdot
        F_{Y(1)}(z|X_k)
            \ 
            -
            \ 
        F_{Y(1)}(z|X_i)
            \right|
            \ 
            \to
            \ 
            0
            \qquad
            \text{for}
            \ 
            N\to\infty
      \end{align*}
\end{enumerate}
\end{lemma}
\begin{proof}
If at least one 
$
B_k(X,X_1,\ldots,X_N)
>
0
$, the basis functions sum to 1. If $B_k(X,X_1,\ldots,X_N)=0$ for all basis functions, the sum is 0.
Thus
\begin{align}
  \label{8882}
  &
  \sum_{k=1}^{N}
B_k(X,X_1,\ldots,X_N)
  \ 
  \in
  \ 
  \left\{ 0,1 \right\}
  \notag
  \intertext{
Since $B_i(X_i,X_1,\ldots,X_N)>0$, it holds
  }
  &
  \sum_{k=1}^{N}
  B_k(X_i)
  \ 
  =
 \  
  1
  \qquad
  \text{for all}\ 
  i\in
  \left\{ 1,\ldots,N \right\}
  \,.
\end{align}
We prove \textit{(i)}.
Since 
\begin{gather*}
B_k(X,X_1,\ldots,X_N)
\ 
\in
\ 
[0,1]
\qquad
\text{for all}\ 
k\in \left\{ 1,\ldots,N \right\}
\,,
\end{gather*}
it holds
\begin{gather*}
  \label{basis_l2_bdd}
  \norm{
B(X,X_1,\ldots,X_N)
}_2^2
  \ 
  =
  \ 
  \sum_{k=1}^{N} 
B(X,X_1,\ldots,X_N)
  ^2
  \ 
  \le
  \ 
  \sum_{k=1}^{N} 
B(X,X_1,\ldots,X_N)
  \ 
  \in
  \ 
  \left\{ 0,1 \right\}
\,.
\end{gather*}

 Note, that for all continuous functions $f\colon \R^d\to \R$ it holds
 \begin{align}
   \begin{split}
   &
   \left|
  \sum_{k=1}^{N}
    B_k(X_i,X_1,\ldots,X_N)\cdot 
    f(X_k)
    -
    f(X_i)
   \right|
   \\
   &
   \ 
   \le
   \ 
  \sum_{k=1}^{N}
    B_k(X_i,X_1,\ldots,X_N)
    \mathbf{1}\left\{
      X_k\in A_N(X_i)
    \right\}
    \left|
    f(X_k)
    -
    f(X_i)
    \right|
   \\
   &
   \ 
   \le
   \ 
   \omega
   \left(
    f,h_N^d
   \right)
   \,,
   \end{split}
 \end{align}
 where $\omega(f,\cdot)$ is the modulus of continuity of $f$. 
 Thus
      \begin{align*}
        \frac
        {1}
        {N}
        \sum_{i,k=1}^{N}
            \left|
        B_k(X,X_1,\ldots,X_N)
        \cdot
            \varphi^{'}
            \left(
              \frac
              {1}
              {\pi(X_k)}
            \right)
            \ 
            -
            \ 
            \varphi^{'}
            \left(
              \frac
              {1}
              {\pi(X_i)}
            \right)
            \right|
            \ 
            \le
            \ 
   \omega
   \left(
     \varphi^{'},h_N^d
   \right)
            \ 
            \to
            \ 
            0
          \end{align*}
          for $N\to\infty$.
          In the same way it follows
      \begin{align*}
            &
        \frac
        {1}
        {\sqrt{N}}
        \sum_{i,k=1}^{N}
        \sup_{z\in\R}
            \left|
        B_k(X,X_1,\ldots,X_N)
        \cdot
        F_{Y(1)}(z|X_k)
            \ 
            -
            \ 
        F_{Y(1)}(z|X_i)
            \right|
            \\
            &
            \ 
            \le
            \ 
            \sqrt{N}
            \sup_{z\in\R}
            \omega
            \left(
        F_{Y(1)}(z|\cdot)
        ,
        h_N^d
            \right)
            \ 
            \to
            \ 
            0
            \qquad
            \text{for}
            \ 
            N\to\infty
            \,.
      \end{align*}
\end{proof}
