\begin{assumption}
  \begin{enumerate}[label={(\roman*)}]
    Assume that the map 
    $
      f: \R \to \overline{\R}
    $
    has the following properties.
    \item
      $
        f 
        \ 
        \text{is strictly convex.}
      $
    \item
      $
        f
        \ 
        \text{is lower-semicontinuous and continuously differentiable on}
        \ 
        \mathrm{int}(\mathrm{dom}(f))
        .
      $
    \item
      $
        \text{The derivative of}\ 
        f\ 
        \text{on}\ 
        \mathrm{int}(\mathrm{dom}(f))
        \ 
        \text{is a diffeomorphism.}
      $
    \item
      $
        \text{The Legendre transformation}
        \ 
        f^*
        \ 
        \text{of}\ 
        f
        \ 
        \text{is finite}
        .
      $
    \item
      $
        \text{The function}\
        x\mapsto xt - f(x)
        \ 
        \text{takes its supremum on}
        \ 
        \mathrm{int}(\mathrm{dom}(f))
        \ 
        \text{for all}
        \ 
        t\in \R.
      $
  \end{enumerate}
\end{assumption}
\todo[color=red!40, inline]{Elaborate on assumptions. Give as a counterexample 
  \[
  f(x):=
  (1+\delta_{x\ge 0})
  (x^2
  +x\cdot \lambda)
\]
}

We consider the following optimization problem.
\begin{problem}
  \begin{gather*}
    \underset{w_1, \ldots, w_n \in \R}{\mathrm{minimize}}
    \qquad
    \sum_{i = 1}^{n} T_i f(w_i)
  \end{gather*}
subject to the constraints
\begin{gather*}
    w_i T_i \ge 0,
    \qquad 
    i = 1, \ldots, n,
    \\
  \sum_{ i = 1 }^{n}
    w_i T_i
  =
  1
  \\
    \left| 
      \sum_{i = 1}^{n} w_i T_i B_k(X_i)
      - 
      \frac{1}{n} \sum_{i = 1}^{n} B_k(X_i)
    \right|
    \le 
    \delta_k,
    \qquad
    k = 1, \ldots, K
\end{gather*}
\end{problem}
\pagebreak
~\begin{ftheorem}
  Under Assumption,
  the dual of the above Problem is the unconstrained optimization problem 
  \begin{gather*}
    \underset{\lambda \in \R^K}{\mathrm{minimize}}
    \qquad
    \frac{1}{n}
    \sum_{i = 1}^{n} 
    nT_i 
    f^*
    (
      \inner{B(X_i)}{\lambda}
    )
    -
    \inner{B(X_i)}{\lambda}
    +
    \inner{\delta}{\left| \lambda \right|}
    ,
  \end{gather*}
  where
  $
  t \mapsto
    f^*(t)
    =
    t\,(f^{'})^{-1}(t)
    -
    f
    \left( 
      (f^{'})^{-1}(t)
    \right)
  $
  is the Legendre transformation of $f$,
  $
    B(X_i)
    =
    \left[ 
      B_1(X_i)
      ,
      \ldots
      ,
      B_K(X_i)
    \right]
    ^\top
  $
  denotes the $K$ basis functions of the covariates 
  of unit $i\in \left\{ 1, \ldots, n \right\}$
  and
  $
    \left| \lambda \right|
    =
    \left[ 
      \left| \lambda_1 \right|
      ,
      \ldots
      ,
      \left| \lambda_K \right|
    \right]
    ^\top
    ,
  $
  where $\left| \,\cdot\, \right|$
  is the absolute value of a real-valued scalar.
  Moreover, if $\lambda^\dagger$
  is an optimal solution then
  \begin{gather*}
    w_i^*
    =
    (f^{'})^{-1}
    (
      \inner{B(X_i)}{\lambda^\dagger}
    )
    ,
    \quad
    i\in \left\{ 1,\ldots, n \right\}
  \end{gather*}
  are the unique optimal solutions to (P)
  .
\end{ftheorem}
\begin{proof}
  We prove the following Lemma at the end of the section.
  \begin{lemma}
    The dual of the optimization problem is
  \begin{gather*}
    \underset{\lambda \in \R^{2K}}{\mathrm{minimize}}
    \qquad
    \frac{1}{n}
    \sum_{i = 1}^{n} 
    nT_i 
    f^*
    (
    \inner{Q_{\bullet i}}{\lambda}
    )
    -
    \inner{Q_{\bullet i}}{\lambda}
    +
    \inner{d}{\lambda}
  \end{gather*}
  subject to
  \begin{gather*}
    \lambda_k \ge 0
    \quad
    \text{for all}\ 
    k \in \left\{ 1, \ldots, K \right\}
    ,
  \end{gather*}
  where
  \begin{gather*}
    \mathbf{Q}
    :=
    \begin{bmatrix}
      \mathbf{I}_n\\
      \mathbf{B}(\mathbf{X})\\
      -\mathbf{B}(\mathbf{X})
    \end{bmatrix}
    ,
    \qquad
    \mathbf{B}(\mathbf{X})
    :=
    \begin{bmatrix}
      B(X_1), \ldots, B(X_n)
    \end{bmatrix}
    ,
    \qquad
    \text{and}
    \qquad
    d
    :=
    \begin{bmatrix}
      0_n\\
      \delta \\
      \delta
    \end{bmatrix}
    .
  \end{gather*}

  \end{lemma}
  \begin{proof}
    \emph{Lemma}
    We write the optimization problem in the form of \cite{Tseng1991}.
    \begin{gather*}
    \underset{w_1, \ldots, w_n \in \R}{\mathrm{minimize}}
    \qquad
    \sum_{i = 1}^{n} T_i f(w_i)
    \\
    w_i T_i \ge 0,
    \qquad 
    i = 1, \ldots, n,
    \\
  \sum_{ i = 1 }^{n}
    w_i T_i
  =
  1
    \\  
      \sum_{i = 1}^{n} w_i T_i B_k(X_i)
      \ge
      -\delta_k
      + 
      \frac{1}{n} \sum_{i = 1}^{n} B_k(X_i)
      \quad
      k=1,\ldots,K
    \\  
    -  \sum_{i = 1}^{n} w_i T_i B_k(X_i)
      \ge
      -\delta_k
      - 
      \frac{1}{n} \sum_{i = 1}^{n} B_k(X_i)
      \quad
      k=1,\ldots,K
    \end{gather*}
    Next we write
 \begin{gather*}
    \mathbf{Q}
    :=
    \begin{bmatrix}
      \mathbf{diag}[T_1,\ldots,T_n]\\
      \mathbf{B}(\mathbf{X})\\
      -\mathbf{B}(\mathbf{X})
    \end{bmatrix}
    ,
    \qquad
    \mathbf{B}(\mathbf{X})
    :=
    \begin{bmatrix}
      T_1B(X_1), \ldots, T_nB(X_n)
    \end{bmatrix}
    ,
    \qquad
    \text{and}
    \qquad
    d
    :=
    \begin{bmatrix}
      0_n\\
      -\delta 
      + \overline{B(\mathbf{X})}
      \\
      -\delta
      - \overline{B(\mathbf{X})}
    \end{bmatrix}
    ,
  \end{gather*}
  where
  $
       \overline{B(\mathbf{X})}
       :=
       [
       \overline{B_1(\mathbf{X})}
       ,
       \ldots
       ,
       \overline{B_K(\mathbf{X})}
       ]
       ^\top
  $
and
$
       \overline{B_k(\mathbf{X})}
       :=
      \frac{1}{n} \sum_{i = 1}^{n} B_k(X_i)
      .
$
We get
\begin{gather*}
    \underset{w_1, \ldots, w_n \in \R}{\mathrm{minimize}}
    \qquad
    \sum_{i = 1}^{n} T_i f(w_i)
    \\
    \mathrm{1}_n \cdot w
    =0
    \\
    \mathbf{Q}w \ge d
\end{gather*}
The convex conjugate is
\begin{gather*}
  \sum_{T_i=1} T_i f^*(\lambda_i)
  +
  \sum_{T_i=0} 
  \delta_{\left\{ 0 \right\}}(\lambda_i)
  .
\end{gather*}
Since
$
\mathbf{Q}_{\bullet i}=\mathrm{0}_n
\ 
\text{if}
\ 
T_i=0
$
we get the desired representation. Note that the equality constraint vanishes automatically.
  \end{proof}

\todo[color=red!40, inline]{Continue with paraphrase of \cite[page 20]{Wang2019}}

\end{proof}
