\documentclass[11pt, a4paper, BCOR=7mm, DIV=11]{scrbook}
\linespread{1.25}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
%\usepackage[a4paper, margin=2.5cm]{geometry}
\usepackage{hyperref}
\usepackage{amsmath}
\usepackage{enumitem}
%\usepackage{mdframed}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{imakeidx}
\makeindex[columns=3, title=Index, intoc]
\usepackage{mathtools}
%\usepackage{fdsymbol}
\usepackage{cite}
\graphicspath{ {images/} }
\usepackage{xcolor}         % Extended colors
\usepackage{color}         % Color extended names
\usepackage{nomencl}
\usepackage[nottoc]{tocbibind}
\usepackage{lipsum}
\usepackage[tickmarkheight=0.1cm, colorinlistoftodos]{todonotes}
\makenomenclature
\renewcommand{\nomname}{Notation Index}
\mathsurround=2pt
\usepackage[framemethod=TikZ]{mdframed}
\mdfsetup{%
   middlelinecolor=black,
   middlelinewidth=.5pt,
   backgroundcolor=gray!2,
   roundcorner=5pt}
\newsavebox{\selvestebox}
\newenvironment{takeaways}
  {
   \begin{lrbox}{\selvestebox}%
   \begin{minipage}{12.4cm}
     \textbf{Takeaways}
   }
  {\end{minipage}\end{lrbox}%
   \begin{center}
\setlength\fboxsep{.5cm}
   \colorbox[HTML]{F8E0E0}{\usebox{\selvestebox}}
   \end{center}}
% Theorem handle

\newtheorem{gtheorem}{Theorem}[chapter]
\newenvironment{theorem}
  {\begin{mdframed}\begin{gtheorem}}
  {\end{gtheorem}\end{mdframed}}
\newtheorem*{theorem*}{Theorem}
\newtheorem*{definition*}{Definition}
\newtheorem*{lemma*}{Lemma}
\newenvironment{ftheorem}
  {\begin{mdframed}\begin{gtheorem}}
  {\end{gtheorem}\end{mdframed}}
\newenvironment{ftheorem*}
  {\begin{mdframed}\begin{theorem*}}
  {\end{theorem*}\end{mdframed}}
\newtheorem{fassumption}{Assumption}
\newenvironment{assumption}
{\begin{mdframed}[
   backgroundcolor=red!2,
    ]
    \begin{fassumption}}
  {\end{fassumption}\end{mdframed}}

\newtheorem*{assumptions*}{Assumptions}
\newtheorem{corollary}{Corollary}[gtheorem]

\theoremstyle{definition}
\newtheorem{fdefinition}{Definition}[chapter]
\newenvironment{definition}
{\begin{mdframed}[
   backgroundcolor=gray!2,
    ]
    \begin{fdefinition}}
  {\end{fdefinition}\end{mdframed}}
\newtheorem*{remark/}{Remark}
\newenvironment{remark}
  {\renewcommand{\qedsymbol}{$\diamondsuit$}%
   \pushQED{\qed}\begin{remark/}}
  {\popQED\end{remark/}}
\newtheorem{example/}{Example}[chapter]
\newenvironment{example}
  {\renewcommand{\qedsymbol}{$\diamondsuit$}%
   \pushQED{\qed}\begin{example/}}
  {\popQED\end{example/}}
\newtheorem*{example*/}{Example}
\newenvironment{example*}
  {\renewcommand{\qedsymbol}{$\diamondsuit$}%
   \pushQED{\qed}\begin{example*/}}
  {\popQED\end{example*/}}
\newtheorem*{reflection*/}{Reflection}
\newenvironment{reflection*}
  {\renewcommand{\qedsymbol}{$\spadesuit$}%
   \pushQED{\qed}\begin{reflection*/}}
  {\popQED\end{reflection*/}}
\newtheorem{problem}{Problem}
\newenvironment{fproblem}
  {\begin{mdframed}\begin{problem}}
  {\end{problem}\end{mdframed}}
  %%%% plain %%%%
\theoremstyle{plain}
\newtheorem{flemma}{Lemma}[chapter]
\newenvironment{lemma}
{\begin{mdframed}\begin{flemma}}
  {\end{flemma}\end{mdframed}}
\newtheorem{proposition}{Proposition}[chapter]
\newtheorem*{proposition*}{Proposition}
%\newtheorem{subassumption}{}[assumption]

\renewcommand{\proofname}{\textbf{Proof}}
% definition of constants

\newcommand{\CP}{C_\P}
\newcommand{\Ctau}{C_\tau}
\newcommand{\LearnRate}{\varepsilon_n}

%
\DeclarePairedDelimiterX{\inner}[2]{\langle}{\rangle}{#1, #2}
\newcommand{\C}{\mathbb{C}}
\newcommand{\G}{\mathbb{G}}
\newcommand{\E}{\mathbf{E}}
\renewcommand{\P}{\mathbf{P}}
\newcommand{\R}{\mathbb{R}}
\newcommand\norm[1]{\left\lVert#1\right\rVert}


\setlength {\marginparwidth }{2cm}

\begin{document}

\begin{titlepage}
 \begin{center}
       \vspace*{1cm}
       \textbf{
    A Novel Weighted Mean Approach to Estimate the Distribution Function of Potential Outcomes in Observational Studies 
  }

       \vspace{0.5cm}
       Asymptotic Analysis
            
       \vspace{1.5cm}

       \textbf{Ioan Scheffel}

       \vfill
            
       A thesis presented for the degree of\\
       Master of Science Mathematics
            
       \vspace{0.8cm}
     
     %  \includegraphics[width=0.4\textwidth]{university}
      
       supervised by PD Dr. Jürgen Dippon
       \\
            Institute for Stochastics and Applications
            \\
       Faculty 8: Mathematics and Physics
       \\
University of Stuttgart
\\
submitted at April 18, 2023
   \end{center}
\end{titlepage}
\cleardoublepage
%\maketitle
\frontmatter

\pagenumbering{roman}
\newpage
\begin{center}
\textbf{
Eigenständigkeitserklärung
}
\end{center}
Ich erkläre mit meiner Unterschrift,
dass ich diese Arbeit selbstständig verfasst habe und keine
anderen als die angegebenen Quellen benutzt habe.
Alle Stellen dieser Arbeit, die dem Wortlaut,
dem Sinn oder der Argumentation nach anderen Werken entnommen sind 
(einschließlich des World
Wide Web und anderer elektronischer Text- und Datensammlungen), habe ich unter Angabe der
Quellen vollständig kenntlich gemacht.
\newpage
  \begin{center}
  \textbf{Abstract} \\
  english
  \end{center}
  In this thesis I extend the balancing weights framework of \cite{Wang2019} to estimate the distribution function of potential outcomes in observational studies.
  %
  I also suggest to balance basis functions of non-parametric partitioning estimates. 
  %
  This greatly simplifies the proofs and allows for rigorous mathematical treatment of the method.
  %
  The asymptotic analysis shows convergence of the error to a Gaussian process.
  %
  My findings allow to apply the functional delta method to a large class of plug-in estimators.
  %
  This makes classical statistical methods such as quantile estimation, hypothesis testing or survival analysis accessible to causal inference in observational studies.
  %
  While the theoretical results are promising, this novel approach waits for testing in practice.
\newpage
  \begin{center}
  \textbf{Abstract}
  \\
  german
  \end{center}
  In dieser Arbeit erweitere ich das Balancing Weights Framework von \cite{Wang2019}, um die Verteilungsfunktion von Potential Outcomes in Beobachtungsstudien zu schätzen.
  %
  Ich schlage auch vor, Basisfunktionen nicht-parametrischen Partitioning Estimates auszugleichen.
  %
  Diese Wahl vereinfacht die Beweise wesentlich und erlaubt gründliches mathematisches Vorgehen.
  %
  Die asymptotische Analyse zeigt Konvergenz des Fehlers gegen einen Gaußschen Prozess.
  %
  Die Ergebnisse dieser Arbeit erlauben es die Funktionale Delta Methode auf eine große Klasse von Substitutionsschätzern anzuwenden.
  %
  So erschließt dieser neuartige Zugang der Kausalen Inferenz in Beobachtungsstudien klassische Bereiche der Statistik, wie zum Beispiel Quantil-Schätzung, Hypothesentests, oder Überlebenszeitanalysen.
  %
  Die theoretischen Ergebnisse sind vielversprechend - der Praxis-Test steht allerdings noch aus.
\tableofcontents 
\mainmatter
\pagenumbering{arabic}
\chapter{Introduction}
  \input{chapters/intro_for_all.tex}
\chapter{The Optimization Problem behind the Weights}
  \input{chapters/optimization_problem/main.tex}
\chapter{Constructing the Weights Process}
  \input{chapters/weights_process/main.tex}
  \input{chapters/pseudo_weights/main.tex}
\chapter{Consistency of the Weights Process}
  \input{chapters/consistency_weights/main.tex}
\chapter{Convergence of the Weighted Mean}
  \input{chapters/conv_mean/main.tex}
\chapter{Discussion and Outlook}
  \input{chapters/discussion/main.tex}
\chapter{Convex Analysis}
In our application we want to analyse a convex optimization problem by its dual problem.
In particular we want to obtain primal optimal solutions from dual solutions.
To accomplish the task we need technical tools from convex analysis, 
mainly conjugate calculus and some Karush-Kuhn-Tucker related results.

Our starting point is 
the support function intersection rule~\cite[Theorem 4.23]{Mordukhovich2022}.
We give the details in the case of finite dimensions and refer for the rest of the proof to the book.
The support function intersection rule is applied to give first conjugate sum and then chain rule,
which are vital to calculating convex conjugates. The proofs are omited, since the book is thorough enough. 
%The well known Fenche-Rockafellar Duality theorem is a corollary of conjugate sum and chain rule. It gives general conditions under which dual and primal values coincide.
The material we present is very well known.
As an introduction, we recommend the recent book \cite{Mordukhovich2022} and the classical reference \cite{Rockafellar1970}.
We finish the chapter with ideas from \cite{Tseng1991}. 
They provide the high-level ideas to obtain for strictly convex
functions a dual relationship between optimal solutions.
We will deliver the details that are omited in the paper.
\section{A Convex Analysis Primer}
  \input{chapters/convex_analysis/primer_new.tex}
\section{Duality of Optimal Solutions}
  \input{chapters/convex_analysis/ts_3.tex}

\renewcommand{\bibsection}
{
\chapter*{References}
\addcontentsline{toc}{chapter}{References}
}
\bibliographystyle{alpha}
\bibliography{literature}
\printindex
\end{document}
